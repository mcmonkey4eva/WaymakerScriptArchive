faketab_task:
    type: task
    debug: false
    data:
        blank_blob: ewogICJ0aW1lc3RhbXAiIDogMTY1MjQyMTc4MTIxNSwKICAicHJvZmlsZUlkIiA6ICJmMTdkOWJlZmM2NGM0YzA4ODVhYWU3NWQ0YjhiNWE0NCIsCiAgInByb2ZpbGVOYW1lIiA6ICJTaXJCYW5kZXJzbmF0Y2giLAogICJzaWduYXR1cmVSZXF1aXJlZCIgOiB0cnVlLAogICJ0ZXh0dXJlcyIgOiB7CiAgICAiU0tJTiIgOiB7CiAgICAgICJ1cmwiIDogImh0dHA6Ly90ZXh0dXJlcy5taW5lY3JhZnQubmV0L3RleHR1cmUvNjk1YzQyMWU0Yzc0ZTY1N2E4NGQ2OTgxZDM4NGIyNjNiNWM1YzcxM2RhZjI1ZjgxMDRkNmZhZjQxNTVjMGI5MyIsCiAgICAgICJtZXRhZGF0YSIgOiB7CiAgICAgICAgIm1vZGVsIiA6ICJzbGltIgogICAgICB9CiAgICB9CiAgfQp9;h1FISXbhwjBG2bohQi9BHfPzWhK1EgaBrMwkB6NwIW/Ffbdg0mRGDlStgSGJbbUCbNqtdxWqD5j7hgtMcUVGLTHOu/x6WtSpHPt2ljYwWGQkP1F0hElmkUDRB/QPdYLMkm17wqkWcSN+Uc2HGTj7J/S/9UQueJ1XzSv5UFcKCEazd/XfOoCIfW8is44divUscDzpQgyGrHcu6Ex7K7fTD5ccS3ONLcJlxD5gPiI1jE8TfQT655c/IeaDMTIqMDpc9UgObNZCb9ac5JXa34ymH/5dvDwzqq7+dXm5FlVsSLhbvGfSY4b92fPpICU0daTSIU3fZzEBzzJZgrnF5NxDPHkNjjmA2ZoE4DGfgS4LMM2zS06EZM3d1I3sSSx2C8uBpU0JOwBBNjNd4OWYyinB6nvf642kRo+BLM58LlqaJW1dX3xaPBRx9Jb9j8e+GPwqvmZPmVcfkItBOQ6HEyxZbpsai2z3E8sou+vy8Qm0dzgPJPa2Rk5U4AgO9ZpNq7FtUSNQu4HEqeZxDJYpTIGEshgCTJF6QQ82M17N3Myb6g9Ler2Ncmnt2YoHHGYUELnDqdUMXOdNnN1Zqevzz/UMqAbIALTp0G4cIoqitFPsZ7qRdRiS0ERxkYPYXMRSS5UHPUGFeJIaNYypFQ+wh7rXQ3J6sSqNzkp4H02j6HFtTag=
        gray_blob: ewogICJ0aW1lc3RhbXAiIDogMTY1MjQyMTkzMzM1NSwKICAicHJvZmlsZUlkIiA6ICIyOTNiMmM0NDEwMmQ0ZjRmYjRjMzExM2M0YTYzZDhjYyIsCiAgInByb2ZpbGVOYW1lIiA6ICJDb3NtaWNSZWRXb2xmUngiLAogICJzaWduYXR1cmVSZXF1aXJlZCIgOiB0cnVlLAogICJ0ZXh0dXJlcyIgOiB7CiAgICAiU0tJTiIgOiB7CiAgICAgICJ1cmwiIDogImh0dHA6Ly90ZXh0dXJlcy5taW5lY3JhZnQubmV0L3RleHR1cmUvYzAxMzU0ZDI4ZjkxMDVhOGM5YWQ5MzU1ZTI0MWZlZDFhOWM4Y2E1NzFlYTM3NzExOGYzMmE4MDU3ZmExM2E4MiIsCiAgICAgICJtZXRhZGF0YSIgOiB7CiAgICAgICAgIm1vZGVsIiA6ICJzbGltIgogICAgICB9CiAgICB9CiAgfQp9;eaVZj9NgMBgz6FXOykSogPjO99qwkLyMuiPa4hmqilHzFCCeraEiAUHqM++6ll1EXT/RHX5kdAx2YmPnrmc+vidkA6rj1jev7mw0p/h53nuIrzTyfRJcy9NHzSSCTL53uwEnuojgkwrWWLrMV241xIDnrGrIYHj73t7sTETn0xaDezWmQXzUeBLFc/dNAsWsayn9r/E5fuL7VEiGDu+ig9aMwVSurvmqEqkCMmwMXRszozuZocRVPwx/cwm4fHLkyKQn5FkdUeC6vYGsrI7oMCNdFK30VamO8k7HOyVy3Pz+nZ8gvDka4qfL9zGmPIMMMIXbRNkgpdIOnaT8hZ5oC+wvLykZ40B/SEXr2D9XeK3+tlMTsVE3Cdt8xGTPI4c8PoSM/VKVhckoy7zmIXTNVMMeiqhq8zU83oqzgqVUITmJwJmoNHG6H6NhKO5xcdHUJc2ljQVQ7VPTAIthjiUXkOUyS3jYnxEaHF9kFQRjdpIxJ5pDpM4cj7AF0Cb5dCQdaFmVilx5vWqfnDNYZvpluj03JhjFwm4w4FhKGEYBPmOQdyRLXxxE+e5Z9V2t318F4Xkm6Lzas0QNzJnxvKgWhlYdJlcxMZ5Y58jF/igZb+5mJclasxr2DyMSjn0tD0Pd4VkHYijJwhTVXn1DFWCH2VTJjXUAni5npCg30WRUUYM=
    definitions: text|uuid|display|mode
    script:
    - if <[text].length> > 16:
        - debug log "Not adding tab entry <[text]> for player <player.name> due to length <[text].length>"
        - stop
    - tablist add name:<[text]> display:<[display].if_null[<empty>]> gamemode:<[mode].if_null[spectator]> skin_blob:<script.data_key[data.gray_blob]> latency:9999 uuid:<[uuid].if_null[<util.random_uuid>]>

tabcomplete_tablist_gen:
    type: task
    debug: false
    data:
        completions:
        - [[character]]
        - [[c]]
        - [[helditem]]
        - [[i]]
    script:
    - foreach <script[emojify_proc].data_key[data].keys> as:emoji:
        - run faketab_task def.text:<&co><[emoji]><&co>
    - foreach <script.data_key[data.completions]> as:embed:
        - run faketab_task def.text:<[embed]>

tabcomplete_helper_world:
    type: world
    debug: false
    events:
        after player joins:
        - run tabcomplete_tablist_gen
        - define evt_player <player>
        - define evt_name <[evt_player].name>
        - if <[evt_name].length> > 9:
            - define evt_name <[evt_name].substring[1,9]>
        - foreach <server.online_players> as:other_player:
            - define oth_name <[other_player].name>
            - if <[oth_name].length> > 9:
                - define oth_name <[oth_name].substring[1,9]>
            - run faketab_task def.text:[[c:<[oth_name]>]] def.uuid:<[other_player].uuid.replace_text[4].with[a]>
            - run faketab_task def.text:[[c:<[evt_name]>]] def.uuid:<[evt_player].uuid.replace_text[4].with[a]> player:<[other_player]>
        after player quits:
        - flag <player> faketab_ids:!
        - define evt_player <player>
        - foreach <server.online_players> as:other_player:
            - tablist remove uuid:<[evt_player].uuid.replace_text[4].with[a]> player:<[other_player]>

realfakeplayer_tracker_world:
    type: world
    debug: false
    events:
        after player joins:
        - foreach <bungee.list_servers||<list>> as:server:
            - bungeerun <[server]> add_realfakeplayer_task def:<list_single[<player.uuid>].include_single[<player.skin_blob>]>
        - foreach <server.flag[bungee_player_isonline].keys.filter[as[player].is_online.not]> as:other_player:
            - run add_realfakeplayer_single_task def.player_id:<[other_player]> def.blob:<[other_player].as[player].flag[last_known_blob].if_null[<script[faketab_task].data_key[data.gray_blob]>]>
        after player quits:
        - foreach <bungee.list_servers||<list>> as:server:
            - bungeerun <[server]> remove_realfakeplayer_task def:<player.uuid>

add_realfakeplayer_task:
    type: task
    debug: false
    definitions: player_id|blob
    script:
    - if <[player_id].as[player].is_online||false>:
        - stop
    - flag <[player_id].as[player]> last_known_blob:<[blob]>
    - foreach <server.online_players> as:__player:
        - run add_realfakeplayer_single_task def.player_id:<[player_id]> def.blob:<[blob]>

add_realfakeplayer_single_task:
    type: task
    debug: false
    definitions: player_id|blob
    script:
    - define id <[player_id].replace_text[4].with[b]>
    - define name <server.flag[bungee_player_backup.<[player_id]>]>
    - define display <proc[proc_format_name].context[<[player_id].as[player]>|<player>|true]>
    - tablist add name:<[name]> display:<[display]> gamemode:creative skin_blob:<[blob]> latency:0 uuid:<[id]>

remove_realfakeplayer_task:
    type: task
    debug: false
    definitions: player_id
    script:
    - foreach <server.online_players> as:__player:
        - define id <[player_id].replace_text[4].with[b]>
        - tablist remove uuid:<[id]>
